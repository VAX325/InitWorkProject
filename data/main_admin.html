<!doctype html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="data/main.css" />
	<meta charset="utf-8">
	<title>Главная страница (Администратор)</title>
</head>
<body>
	<button id="showRequests">Заявления</button>
	<button id="showSettings">Личный кабинет</button>
	<button id="showAdminMenu">База Данных (Обновить)</button>
	
	<div id="settings-div" style="%s">
		<form id="settings-data-form" enctype="multipart/form-data" method="post" action="/change_data">
			<select id="settings-data-form-user-select" onchange="UpdateUserSettings()">
				<option value="0">ADMIN</option>
			</select>

			<p>ФИО</p><input id="user_names" name="user_names" type="text">
			<p>Дата рождения</p><input id="user_birthdate" name="user_birthdate" type="text">
			<p>Названия организации</p><input id="user_workname" name="user_workname" type="text">
			<p>Должность</p><input id="user_position" name="user_position" type="text">
			<p>Рабочая почта</p><input id="user_email" name="user_email" type="text">
			<p>Логин</p><input id="user_login" name="user_login" type="text">
			<p>Пароль</p><input id="user_password" name="user_password" type="text">

			<input id="settings-data-from-push" type="submit" value="Push changed data">  <!--id="settings-data-from-push">Push changed data</button> -->
		</form>
		<!--<button id="settings-data-from-update">Update data</button>-->
	</div>
	
	<div id="requests-div" style="%s"></div>
	
	<div id="adminmenu-div" style="%s">
		<!-- <form id="adminmenu-form-change"> -->
			<!-- <input type="checkbox" id="adminmenu-form-change-true" onclick="DBChange(0)">Change</input> -->
			<!-- <input type="checkbox" id="adminmenu-form-change-false" onclick="DBChange(1)">Create</input> -->
		<!-- </form> -->
	
		<table id="adminmenu-table">
			<tbody>
			<!-- huh -->
			</tbody>
		</table>
		
		<!-- <form id="adminmenu-form-apply"> -->
			<!-- ID:<input id="adminmenu-newusr-id"></input> -->
			<!-- ADM:<input id="adminmenu-newusr-adm"></input> -->
			<!-- DOB:<input id="adminmenu-newusr-dob"></input> -->
			<!-- ORGNAME:<input id="adminmenu-newusr-orgname"></input> -->
			<!-- POS:<input id="adminmenu-newusr-pos"></input> -->
			<!-- EMAIL:<input id="adminmenu-newusr-email"></input> -->
			<!-- LOGIN:<input id="adminmenu-newusr-login"></input> -->
			<!-- PASS:<input id="adminmenu-newusr-password"></input> -->
			
			<!-- <button id="adminmenu-form-apply" onclick="DBApplyData">Apply</button> -->
		<!-- </form> -->
	</div>

	<script language="javascript">
        window.onload = function () {
			UpdateUserList();
            UpdateUserSettings();
        };

		const requests = document.getElementById("requests-div")
		const settings = document.getElementById("settings-div")
		const admmenu = document.getElementById("adminmenu-div")
		const showRequests = document.getElementById("showRequests")
		const showSettings = document.getElementById("showSettings")
		const showAdminMenu = document.getElementById("showAdminMenu")
		
		showRequests.addEventListener("click", () => {
			requests.style.display = "block"
			settings.style.display = "none"
			admmenu.style.display = "none"
		})

		function UpdateUserSettings()
		{
            const strUser = user_selector.value;
			let data_tosend = window.location.href.concat('', '?GTCONUSRDATA=' + strUser);

			httpGetAsync(data_tosend, OnGetConcreteUserData)

			curr_usr = user_selector.value;
		}

        const settings_select = document.getElementById("settings-data-form-user-select");
		function UpdateUserListCallback(response)
		{
            const array = JSON.parse(response).users
			console.log(array)

            var i, L = settings_select.options.length - 1;
			for (i = L; i >= 0; i--)
			{
                settings_select.remove(i);
			}

			for (var i = 0; i <= array.length - 1; i++)
			{
                var opt = document.createElement('option');
				opt.value = i;
                opt.innerHTML = array[i].names;
                settings_select.appendChild(opt);
            }
		}

		function UpdateUserList()
		{
            const strUser = user_selector.value;
            let data_tosend = window.location.href.concat('', '?UPDUSRS=true');

            httpGetAsync(data_tosend, UpdateUserListCallback)

            curr_usr = user_selector.value;
		}

		showSettings.addEventListener("click", () => {
			requests.style.display = "none"
			settings.style.display = "block"
			admmenu.style.display = "none"

			UpdateUserList();
			UpdateUserSettings();
		})
		
		const admmenu_table = document.getElementById("adminmenu-table");
		const admnenu_tbody = admmenu_table.getElementsByTagName("tbody")[0];
		function ClearAdmnTable()
		{
			const rowCount = admmenu_table.rows.length;
			while(admmenu_table.rows.length > 0) {
				admmenu_table.deleteRow(0);
			}
			
			const row = document.createElement("tr");
			
			const cell1 = document.createElement("th");
			const cell2 = document.createElement("th");
			const cell3 = document.createElement("th");
			const cell4 = document.createElement("th");
			const cell5 = document.createElement("th");
			const cell6 = document.createElement("th");
			const cell7 = document.createElement("th");
			const cell8 = document.createElement("th");
			const cell9 = document.createElement("th");
			
			cell1.innerHTML = "ID";
			cell2.innerHTML = "ADMIN";
			cell3.innerHTML = "NAMES";
			cell4.innerHTML = "Date of birth";
			cell5.innerHTML = "Org. name";
			cell6.innerHTML = "Position";
			cell7.innerHTML = "E-Mail";
			cell8.innerHTML = "Login";
			cell9.innerHTML = "Password";
			
			row.appendChild(cell1);
			row.appendChild(cell2);
			row.appendChild(cell3);
			row.appendChild(cell4);
			row.appendChild(cell5);
			row.appendChild(cell6);
			row.appendChild(cell7);
			row.appendChild(cell8);
			row.appendChild(cell9);
			
			admnenu_tbody.appendChild(row);
		}
		
		function CreateUser(user)
		{
			const row = document.createElement("tr");
			
			const cell1 = document.createElement("td");
			const cell2 = document.createElement("td");
			const cell3 = document.createElement("td");
			const cell4 = document.createElement("td");
			const cell5 = document.createElement("td");
			const cell6 = document.createElement("td");
			const cell7 = document.createElement("td");
			const cell8 = document.createElement("td");
			const cell9 = document.createElement("td");
			
			cell1.innerHTML = user.id;
			cell2.innerHTML = user.adm;
			cell3.innerHTML = user.names;
			cell4.innerHTML = user.dob;
			cell5.innerHTML = user.orgname;
			cell6.innerHTML = user.pos;
			cell7.innerHTML = user.email;
			cell8.innerHTML = user.login;
			cell9.innerHTML = user.pass;
			
			row.appendChild(cell1);
			row.appendChild(cell2);
			row.appendChild(cell3);
			row.appendChild(cell4);
			row.appendChild(cell5);
			row.appendChild(cell6);
			row.appendChild(cell7);
			row.appendChild(cell8);
			row.appendChild(cell9);
			
			admnenu_tbody.appendChild(row);  
		}
		
		function OnGetUsersData(response)
		{
			const array = JSON.parse(response).users
			
			// Clearing table first
			ClearAdmnTable()
			
			for(let i = 0; i < array.length; ++i)
			{
				CreateUser(array[i])
			}
		}
		
		showAdminMenu.addEventListener("click", () => {
			requests.style.display = "none"
			settings.style.display = "none"
			admmenu.style.display = "block"
			
			httpGetAsync(window.location.href.concat('', '?GTUSRDATA=true'), OnGetUsersData)
		})
		
		function httpPostAsync(theURL, data, callback, encrypt)
		{
			const xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() {
				if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
					callback(xmlHttp.responseText);
				}
			}
			xmlHttp.open("POST", theURL, true); // true for asynchronous
			xmlHttp.setRequestHeader('Content-Type', encrypt);
			xmlHttp.send(data);
		}
		
		function httpGetAsync(theUrl, callback)
		{
			const xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() {
			if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
				callback(xmlHttp.responseText);
			}
			xmlHttp.open("GET", theUrl, true); // true for asynchronous
			xmlHttp.send(null);
		}
		
		const user_selector = document.getElementById("settings-data-form-user-select");
		let curr_usr = 0;
		
		const settings_form_names = document.getElementById("user_names")
		const settings_form_birthdate = document.getElementById("user_birthdate")
		const settings_form_workname = document.getElementById("user_workname")
        const settings_form_position = document.getElementById("user_position")
		const settings_form_email = document.getElementById("user_email")
		const settings_form_login = document.getElementById("user_login")
		const settings_form_password = document.getElementById("user_password")
		
		function OnGetConcreteUserData(response)
		{
			const users = JSON.parse(response).users
			console.log(users[0]);

			settings_form_names.value = users[0].names;
			settings_form_birthdate.value = users[0].dob;
			settings_form_workname.value = users[0].orgname;
			settings_form_position.value = users[0].pos;
			settings_form_email.value = users[0].email;
			settings_form_login.value = users[0].login;
			settings_form_password.value = users[0].pass;
		}
		
		//const updateUserdata = document.getElementById("settings-data-from-update")
		//updateUserdata.addEventListener("click", () => {
		//	const strUser = user_selector.value;
		//	let data_tosend = window.location.href.concat('', '?GTCONUSRDATA=' + strUser);
			
		//	httpGetAsync(data_tosend, OnGetConcreteUserData)
			
		//	curr_usr = user_selector.value;
		//})
		
		function finall(response)
		{
			console.log("huray!")
		}
		
		//const pushUserdata = document.getElementById("settings-data-from-push")
		//pushUserdata.addEventListener("click", () => {
		//	const strUser = user_selector.value;
		//	let data_tosend = '/change_data' //window.location.host.concat('', ); // + strUser
			
		//	let user = 
		//	{
		//		names: settings_form_names.value,
		//		dob: settings_form_birthdate.value,
		//		orgname: settings_form_workname.value,
		//		email: settings_form_email.value,
		//		login: settings_form_login.value,
		//		pass: settings_form_password.value
		//	}
		//	console.log(user)
			
		//	let feed = JSON.stringify(user)
			
		//	console.log(user)
			
		//	let data = [];
		//	data.push(feed);
			
		//	//<form enctype="multipart/form-data" method="post" action="/post">
			
		//	console.log(feed)
		//	httpPostAsync(data_tosend, feed, finall, "multipart/form-data")
		//})
	</script>
</body>
</html>
